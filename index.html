<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Solace - Healing Word Search</title>
    <style>
        /* --- CSS: Visuals & Animations --- */
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap');

        :root {
            /* Healing Palette */
            --primary: #7c73e6;       /* Soft Indigo */
            --secondary: #b3a7f7;     /* Lavender */
            --accent: #26de81;        /* Healing Green */
            --text: #2d3436;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.6);
            --highlight: rgba(124, 115, 230, 0.2); 
            --found: #a0e7e5;         /* Calming Cyan */
            --found-text: #006266;
            --def-box-bg: #fff;
        }

        body {
            font-family: 'Outfit', sans-serif;
            /* Breathing Gradient Animation */
            background: linear-gradient(300deg, #a8edea, #fed6e3, #d299c2);
            background-size: 180% 180%;
            animation: gradient-animation 18s ease infinite;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text);
            user-select: none;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Particles Canvas */
        #confetti-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 20;
        }

        .container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 28px;
            border: 1px solid var(--glass-border);
            padding: 2.5rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 950px;
            width: 90%;
            position: relative;
            z-index: 10;
            animation: fade-in-up 1s ease-out;
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        h1 { 
            margin: 0; 
            font-weight: 700; 
            color: var(--primary); 
            letter-spacing: -0.5px; 
            font-size: 2.2rem;
        }

        .controls { display: flex; gap: 8px; flex-wrap: wrap; }

        button {
            background: white;
            border: 1px solid rgba(0,0,0,0.05);
            padding: 10px 18px;
            border-radius: 14px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            color: var(--text);
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            transition: all 0.2s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        button:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.08); }
        button.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* Specific Button Styles */
        .icon-btn { font-size: 1.1rem; padding: 10px 14px; }
        
        /* Definition Box */
        #definition-box {
            background: var(--def-box-bg);
            border-left: 6px solid var(--primary);
            padding: 18px;
            border-radius: 12px;
            min-height: 55px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            transition: transform 0.3s ease;
        }

        #def-word {
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        #def-text {
            font-size: 1rem;
            color: #555;
            line-height: 1.5;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%; height: 6px;
            background: #f1f2f6;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Game Area */
        .game-area {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }

        /* Grid */
        #grid {
            display: grid;
            gap: 5px;
            background: rgba(255,255,255,0.4);
            padding: 12px;
            border-radius: 20px;
            touch-action: none;
        }

        .cell {
            width: 40px; height: 40px;
            display: flex; justify-content: center; align-items: center;
            background: white;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            text-transform: uppercase;
            font-size: 1.2rem;
            color: #444;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .cell { width: 32px; height: 32px; font-size: 0.95rem; }
            .container { padding: 1.5rem; width: 92%; border-radius: 20px;}
            .game-area { flex-direction: column-reverse; align-items: center; }
            .word-list { width: 100%; flex-direction: row; flex-wrap: wrap; justify-content: center;}
            .header { justify-content: center; text-align: center; }
            .controls { justify-content: center; margin-top: 10px; }
            h1 { font-size: 1.8rem; width: 100%; }
        }

        .cell:hover { transform: scale(1.1); z-index: 2; background: #fdfbfb; }
        .cell.highlight { background: var(--highlight); color: var(--primary); }
        .cell.found { background: var(--found); color: var(--found-text); animation: pulse 0.4s ease; }

        @keyframes pulse { 50% { transform: scale(1.15); } }

        /* Word List */
        .word-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 180px;
        }

        .word-item {
            padding: 10px 16px;
            background: rgba(255,255,255,0.6);
            border-radius: 12px;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s;
            cursor: pointer;
            border-left: 3px solid transparent;
            display: flex; justify-content: space-between;
        }
        
        .word-item:hover {
            background: white;
            transform: translateX(4px);
            border-left: 3px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .word-item.found {
            text-decoration: line-through;
            opacity: 0.5;
            background: var(--found);
            color: var(--found-text);
            pointer-events: none;
            border-left: 3px solid transparent;
        }

        /* Overlays */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.96);
            border-radius: 28px;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
            text-align: center;
            padding: 30px;
            box-sizing: border-box;
        }

        #start-screen { display: flex; } /* Initial State */

        .overlay h2 { font-size: 2.5rem; color: var(--primary); margin-bottom: 15px; }
        .overlay p { font-size: 1.1rem; line-height: 1.6; color: #555; max-width: 500px; margin-bottom: 30px; }
        
        .btn-large {
            padding: 16px 45px;
            font-size: 1.2rem;
            font-weight: 600;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(124, 115, 230, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-large:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(124, 115, 230, 0.4);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #dcdde1; border-radius: 10px; }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    
    <div id="start-screen" class="overlay">
        <h2>Solace</h2>
        <p>A healing word search designed to calm your mind and improve focus.</p>
        <button class="btn-large" onclick="startGame()">Begin Healing</button>
    </div>

    <div id="about-screen" class="overlay">
        <h2>Why Solace?</h2>
        <p>We created this as a <strong>digital sanctuary</strong>. <br>Finding patterns in chaos (like words in a grid) triggers dopamine and lowers cortisol (stress).</p>
        <p>Click any word in the list to learn its meaning.</p>
        <button class="btn-large" onclick="closeAbout()">Return</button>
    </div>

    <div id="win-overlay" class="overlay">
        <h2>Peace Found</h2>
        <p>You have completed this session. Take a deep breath.</p>
        <button class="btn-large" onclick="resetGame()">New Session</button>
    </div>

    <div class="header">
        <h1>Solace</h1>
        <div class="controls">
            <button onclick="setDifficulty('easy')" id="btn-easy">Gentle</button>
            <button onclick="setDifficulty('medium')" id="btn-medium" class="active">Focus</button>
            <button onclick="setDifficulty('hard')" id="btn-hard">Deep</button>
            
            <button class="icon-btn" onclick="openAbout()" title="About">?</button>
        </div>
    </div>

    <div id="definition-box">
        <div id="def-word">Welcome</div>
        <div id="def-text">Click any word below to see its meaning, or find words to reveal them.</div>
    </div>

    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div class="game-area">
        <div id="grid"></div>
        <div class="word-list" id="word-list"></div>
    </div>
</div>

<script>
    // --- DICTIONARY ---
    const DICTIONARY = {
        "HEALING": "The process of making or becoming sound or healthy again.",
        "SOLACE": "Comfort or consolation in a time of distress or sadness.",
        "PEACE": "Freedom from disturbance; tranquility.",
        "CALM": "Not showing or feeling nervousness, anger, or other emotions.",
        "BREATH": "The air taken into or expelled from the lungs.",
        "LIGHT": "The natural agent that stimulates sight and makes things visible.",
        "HOPE": "A feeling of expectation and desire for a certain thing to happen.",
        "JOY": "A feeling of great pleasure and happiness.",
        "LOVE": "An intense feeling of deep affection.",
        "GRACE": "Simple elegance or refinement of movement.",
        "SILENCE": "Complete absence of sound.",
        "NATURE": "The phenomena of the physical world collectively.",
        "RIVER": "A large natural stream of water flowing in a channel to the sea.",
        "OCEAN": "A very large expanse of sea.",
        "FOREST": "A large area covered chiefly with trees and undergrowth.",
        "MOUNTAIN": "A large natural elevation of the earth's surface.",
        "VALLEY": "A low area of land between hills or mountains.",
        "GARDEN": "A piece of ground used for growing flowers or vegetables.",
        "SKY": "The region of the atmosphere and outer space seen from the earth.",
        "CLOUD": "A visible mass of condensed water vapor floating in the atmosphere.",
        "RAIN": "Moisture condensed from the atmosphere that falls visibly in separate drops.",
        "STORM": "A violent disturbance of the atmosphere with strong winds.",
        "WIND": "The perceptible natural movement of the air.",
        "SUN": "The star around which the earth orbits.",
        "MOON": "The natural satellite of the earth.",
        "STAR": "A fixed luminous point in the night sky.",
        "SPACE": "The physical universe beyond the earth's atmosphere.",
        "DREAM": "A series of thoughts, images, and sensations occurring in a person's mind during sleep.",
        "SLEEP": "A condition of body and mind that typically recurs for several hours every night.",
        "REST": "Cease work or movement in order to relax, refresh oneself, or recover strength.",
        "FOCUS": "The center of interest or activity.",
        "MIND": "The element of a person that enables them to be aware of the world.",
        "SOUL": "The spiritual or immaterial part of a human being.",
        "SPIRIT": "The nonphysical part of a person which is the seat of emotions and character.",
        "LIFE": "The existence of an individual human being or animal.",
        "TRUTH": "That which is in accordance with fact or reality.",
        "WISDOM": "The quality of having experience, knowledge, and good judgment.",
        "KINDNESS": "The quality of being friendly, generous, and considerate.",
        "PATIENCE": "The capacity to accept or tolerate delay without getting angry.",
        "COURAGE": "The ability to do something that frightens one.",
        "STRENGTH": "The quality or state of being physically strong.",
        "TRUST": "Firm belief in the reliability, truth, ability, or strength of someone.",
        "FAITH": "Complete trust or confidence in someone or something.",
        "EMPATHY": "The ability to understand and share the feelings of another.",
        "CLARITY": "The quality of being coherent and intelligible.",
        "BALANCE": "An even distribution of weight enabling someone to remain upright.",
        "HARMONY": "The quality of forming a pleasing and consistent whole.",
        "GROWTH": "The process of developing or maturing physically, mentally, or spiritually."
    };

    let gridSize = 10;
    let wordsToFind = [];
    let grid = [];
    let isSelecting = false;
    let selectionStart = null;
    let selectedCells = [];
    let foundWordsCount = 0;
    
    // --- Core Functions ---

    function startGame() {
        const startScreen = document.getElementById('start-screen');
        startScreen.style.opacity = '0';
        setTimeout(() => startScreen.style.display = 'none', 500);
        
        // No sound function call needed here.
        initGame(8);
    }

    // Removed toggleMusic function

    // --- Overlay Logic ---
    function openAbout() { document.getElementById('about-screen').style.display = 'flex'; }
    function closeAbout() { document.getElementById('about-screen').style.display = 'none'; }

    // --- Dictionary Logic ---
    function showDefinition(word) {
        const def = DICTIONARY[word] || "Find this word to clear your mind.";
        const box = document.getElementById('definition-box');
        
        box.style.transform = "scale(0.98)";
        setTimeout(() => box.style.transform = "scale(1)", 150);

        document.getElementById('def-word').innerText = word;
        document.getElementById('def-text').innerText = def;
    }

    // --- Game Logic ---
    function setDifficulty(level) {
        document.querySelectorAll('.controls button').forEach(b => {
            if(b.id.startsWith('btn-')) b.classList.remove('active');
        });
        document.getElementById(`btn-${level}`).classList.add('active');

        if (level === 'easy') { gridSize = 9; initGame(6); } 
        else if (level === 'medium') { gridSize = 11; initGame(9); } 
        else { gridSize = 13; initGame(12); }
    }

    function resetGame() {
        const overlay = document.getElementById('win-overlay');
        overlay.style.opacity = '0';
        setTimeout(() => overlay.style.display = 'none', 500);
        
        let count = 9;
        if(document.getElementById('btn-easy').classList.contains('active')) count = 6;
        if(document.getElementById('btn-hard').classList.contains('active')) count = 12;
        initGame(count);
    }

    function initGame(wordCount) {
        document.getElementById('win-overlay').style.display = 'none';
        document.getElementById('win-overlay').style.opacity = '1';
        
        const gridEl = document.getElementById('grid');
        const listEl = document.getElementById('word-list');
        const progressBar = document.getElementById('progress-bar');
        
        document.getElementById('def-word').innerText = "Begin";
        document.getElementById('def-text').innerText = "Select a word to learn its meaning.";

        gridEl.innerHTML = '';
        listEl.innerHTML = '';
        progressBar.style.width = '0%';
        
        grid = Array(gridSize).fill().map(() => Array(gridSize).fill(''));
        foundWordsCount = 0;

        let allWords = Object.keys(DICTIONARY);
        allWords = allWords.filter(w => w.length <= gridSize);
        const shuffled = allWords.sort(() => 0.5 - Math.random());
        wordsToFind = shuffled.slice(0, wordCount);

        wordsToFind.forEach(word => placeWord(word));

        const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        for(let y=0; y<gridSize; y++) {
            for(let x=0; x<gridSize; x++) {
                if(grid[y][x] === '') grid[y][x] = alphabet[Math.floor(Math.random() * alphabet.length)];
            }
        }

        gridEl.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
        
        for(let y=0; y<gridSize; y++) {
            for(let x=0; x<gridSize; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.innerText = grid[y][x];
                cell.dataset.x = x;
                cell.dataset.y = y;
                
                cell.addEventListener('mousedown', handleStart);
                cell.addEventListener('mouseenter', handleEnter);
                cell.addEventListener('touchstart', handleStart, {passive: false});
                gridEl.appendChild(cell);
            }
        }

        document.addEventListener('mouseup', handleEnd);
        gridEl.addEventListener('touchmove', handleTouchMove, {passive: false});
        document.addEventListener('touchend', handleEnd);

        wordsToFind.forEach(word => {
            const item = document.createElement('div');
            item.className = 'word-item';
            item.innerText = word;
            item.dataset.word = word;
            item.onclick = () => showDefinition(word);
            listEl.appendChild(item);
        });
    }

    function placeWord(word) {
        let placed = false, attempts = 0;
        while (!placed && attempts < 100) {
            const dir = Math.floor(Math.random() * 3);
            const r = Math.floor(Math.random() * gridSize);
            const c = Math.floor(Math.random() * gridSize);
            let dr = 0, dc = 0;
            if (dir === 0) dc = 1; else if (dir === 1) dr = 1; else { dr = 1; dc = 1; }

            if (canPlace(word, r, c, dr, dc)) {
                for (let i = 0; i < word.length; i++) grid[r + i * dr][c + i * dc] = word[i];
                placed = true;
            }
            attempts++;
        }
    }

    function canPlace(word, r, c, dr, dc) {
        if (r + dr * (word.length - 1) >= gridSize || r + dr * (word.length - 1) < 0) return false;
        if (c + dc * (word.length - 1) >= gridSize || c + dc * (word.length - 1) < 0) return false;
        for (let i = 0; i < word.length; i++) {
            const char = grid[r + i * dr][c + i * dc];
            if (char !== '' && char !== word[i]) return false;
        }
        return true;
    }

    function handleStart(e) {
        e.preventDefault();
        isSelecting = true;
        const target = e.target.closest('.cell');
        if(!target) return;
        selectionStart = { x: parseInt(target.dataset.x), y: parseInt(target.dataset.y) };
        highlightCells(selectionStart, selectionStart);
    }

    function handleEnter(e) {
        if (!isSelecting) return;
        const target = e.target.closest('.cell');
        if(!target) return;
        highlightCells(selectionStart, { x: parseInt(target.dataset.x), y: parseInt(target.dataset.y) });
    }

    function handleTouchMove(e) {
        if (!isSelecting) return;
        e.preventDefault();
        const touch = e.touches[0];
        const target = document.elementFromPoint(touch.clientX, touch.clientY);
        if (target && target.classList.contains('cell')) {
            highlightCells(selectionStart, { x: parseInt(target.dataset.x), y: parseInt(target.dataset.y) });
        }
    }

    function highlightCells(start, end) {
        document.querySelectorAll('.cell.highlight').forEach(el => el.classList.remove('highlight'));
        selectedCells = [];
        const dx = end.x - start.x;
        const dy = end.y - start.y;
        let stepX = 0, stepY = 0;
        if (dx === 0) stepY = dy > 0 ? 1 : -1;
        else if (dy === 0) stepX = dx > 0 ? 1 : -1;
        else if (Math.abs(dx) === Math.abs(dy)) { stepX = dx > 0 ? 1 : -1; stepY = dy > 0 ? 1 : -1; } 
        else return;

        const len = Math.max(Math.abs(dx), Math.abs(dy));
        for (let i = 0; i <= len; i++) {
            const x = start.x + (i * stepX);
            const y = start.y + (i * stepY);
            const cell = document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
            if (cell) {
                cell.classList.add('highlight');
                selectedCells.push(cell);
            }
        }
    }

    function handleEnd() {
        if (!isSelecting) return;
        isSelecting = false;
        let word = selectedCells.map(c => c.innerText).join('');
        checkWord(word);
        document.querySelectorAll('.cell.highlight').forEach(el => el.classList.remove('highlight'));
        selectedCells = [];
    }

    function checkWord(word) {
        const rev = word.split('').reverse().join('');
        let found = null;
        if (wordsToFind.includes(word)) found = word;
        else if (wordsToFind.includes(rev)) found = rev;

        if (found) {
            const alreadyFound = document.querySelector(`.word-item[data-word='${found}'].found`);
            if(alreadyFound) return;
            
            showDefinition(found);
            selectedCells.forEach(cell => cell.classList.add('found'));
            
            const listItems = document.querySelectorAll('.word-item');
            listItems.forEach(item => {
                if (item.dataset.word === found) {
                    item.classList.add('found');
                    foundWordsCount++;
                }
            });

            const percent = (foundWordsCount / wordsToFind.length) * 100;
            document.getElementById('progress-bar').style.width = `${percent}%`;

            if (foundWordsCount === wordsToFind.length) {
                fireConfetti();
                setTimeout(() => document.getElementById('win-overlay').style.display = 'flex', 800);
            }
        }
    }

    // --- Visual Effects ---
    function fireConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const pieces = [];
        const colors = ['#7c73e6', '#26de81', '#a0e7e5', '#fab1a0'];

        for(let i=0; i<150; i++) {
            pieces.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                w: Math.random() * 10 + 5, h: Math.random() * 10 + 5,
                color: colors[Math.floor(Math.random() * colors.length)],
                speed: Math.random() * 3 + 2, angle: Math.random() * 360
            });
        }
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            pieces.forEach(p => {
                p.y += p.speed; p.angle += 2;
                if(p.y < canvas.height) active = true;
                ctx.save(); ctx.translate(p.x, p.y);
                ctx.rotate(p.angle * Math.PI / 180);
                ctx.fillStyle = p.color; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
                ctx.restore();
            });
            if(active) requestAnimationFrame(draw);
        }
        draw();
    }
    window.addEventListener('resize', () => {
        const c = document.getElementById('confetti-canvas');
        c.width = window.innerWidth; c.height = window.innerHeight;
    });

</script>
</body>
</html>
